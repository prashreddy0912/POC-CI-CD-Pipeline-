phases:
pre_build:
commands:
- set -x
- echo "Verifying AWS CLI and Docker"
- aws --version
- docker --version
- aws sts get-caller-identity
- echo Logging in to Amazon ECR...
- aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 390402565417.dkr.ecr.us-west-2.amazonaws.com
- REPOSITORY_URI=390402565417.dkr.ecr.us-west-2.amazonaws.com/my-app-task

build:
commands:
- echo Building the Docker image...
- docker build -t my-app-task .
- docker tag my-app-task:latest $REPOSITORY_URI:latest

post_build:
commands:
- echo Pushing Docker image...
- docker push $REPOSITORY_URI:latest